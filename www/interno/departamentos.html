<!-- Wappler include head-page="backoffice.html" is="dmx-app" id="departamentos" appConnect="local" bootstrap5="local" capacitor="local" components="{dmxBootstrap5Offcanvas:{},dmxBootstrap5Modal:{},dmxDataTraversal:{}}" fontawesome_4="local" -->
<dmx-data-detail id="data_departamento" dmx-bind:data="listar_departamentos.data.query" key="dep_id"></dmx-data-detail>
<dmx-serverconnect id="listar_departamentos" url="http://localhost:3000/api/electron/cadastros/lista-departamentos" site="rks-controller" dmx-param:id_empresa="usuario_atual.data.query_usuario.empresa_selecionada"></dmx-serverconnect>

<div class="modal" id="modal_departamento" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" nokeyboard="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cadastro de departamento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="form_departamento.reset()"></button>
            </div>
            <div class="modal-body">
                <form id="form_departamento" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/electron/cadastros/criar-departamento" site="rks-controller" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response)" dmx-on:success="listar_departamentos.load({id_empresa: usuario_atual.data.query_usuario.empresa_selecionada});form_departamento.reset();modal_departamento.hide();notificacoes.success('Departamento cadastrado com sucesso!')">
                    <div class="form-group mb-3"> <label for="nome_departamento_ipt" class="form-label">Nome do departamento</label>
                        <input type="text" class="form-control py-2" id="nome_departamento_ipt" name="nome_departamento_ipt" aria-describedby="input1_help">
                        <input id="empresa_dep_ref" name="empresa_dep_ref" type="hidden" class="form-control" dmx-bind:value="usuario_atual.data.query_usuario.empresa_selecionada">
                    </div>
                    <div class="form-group mb-3"> <label for="input2" class="form-label">Descrição</label>
                        <textarea id="descricao_departamento_ipt" class="form-control" name="descricao_departamento_ipt"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" dmx-on:click="form_departamento.reset();modal_departamento.hide()">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="form_departamento.submit()">Cadastrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="modal_editar_departamento" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" nokeyboard="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Atualização de departamento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="form_editar_departamento.reset();data_departamento.select(0);modal_editar_departamento.hide()"></button>
            </div>
            <div class="modal-body">
                <form id="form_editar_departamento" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/electron/cadastros/atualizar-departamento" site="rks-controller" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response)" dmx-on:success="listar_departamentos.load({id_empresa: usuario_atual.data.query_usuario.empresa_selecionada});data_departamento.select(0);form_editar_departamento.reset();modal_editar_departamento.hide();notificacoes.success('Departamento atualizado com sucesso!')">
                    <div class="form-group mb-3"> <label for="editar_nome_departamento_ipt" class="form-label">Nome do departamento</label>
                        <input type="text" class="form-control py-2" id="editar_nome_departamento_ipt" name="editar_nome_departamento_ipt" aria-describedby="input1_help" dmx-bind:value="data_departamento.data.nome_departamento">
                        <input id="id_departamento" name="id_departamento" type="hidden" class="form-control" dmx-bind:value="data_departamento.data.dep_id">
                    </div>
                    <div class="form-group mb-3"> <label for="input2" class="form-label">Descrição</label>
                        <textarea id="editar_descricao_departamento_ipt" class="form-control" name="editar_descricao_departamento_ipt" dmx-bind:value="data_departamento.data.descricao_departamento"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" dmx-on:click="form_editar_departamento.reset();data_departamento.select(0);modal_editar_departamento.hide()">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="form_editar_departamento.submit()">Atualizar cadastro</button>
            </div>
        </div>
    </div>
</div>
<header class="bg-black p-3">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col">
                <h4 class="text-light m-0 mb-1">Departamentos</h4>
                <p class="m-0 text-white-50 subtitulo">A nice paragraph</p>
            </div>
            <div class="col text-end">
                <button id="btn1" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal_departamento">Adicionar novo departamento</button>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid px-5 pt-5">
    <div class="row g-4" is="dmx-repeat" id="repeat_departamentos" dmx-bind:repeat="listar_departamentos.data.query" key="dep_id">
        <div class="col-3">
            <div class="card bg-abstract shadow h-100">
                <div class="card-body p-4">
                    <h4 class="card-title">{{nome_departamento}}</h4>
                    <p class="card-text">{{descricao_departamento}}</p>
                    <div class="d-flex gap-3 flex-row justify-content-start align-items-center"><a class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#modal_editar_departamento" dmx-on:click="data_departamento.select(dep_id)"><i class="fa fa-pencil-square-o"></i></a>
                        <button id="btn2" class="btn btn-primary btn-sm">Adicionar membro</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>