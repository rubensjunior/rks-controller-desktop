<!-- Wappler include head-page="backoffice.html" is="dmx-app" id="departamentos" appConnect="local" bootstrap5="local" capacitor="local" components="{dmxBootstrap5Offcanvas:{},dmxBootstrap5Modal:{}}" fontawesome_4="local" -->
<dmx-serverconnect id="listar_departamentos" url="http://localhost:3000/api/electron/cadastros/lista-departamentos" site="rks-controller" dmx-param:id_empresa="usuario_atual.data.query_usuario.empresa_selecionada"></dmx-serverconnect>

<div class="modal" id="modal_departamento" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" nokeyboard="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cadastro de departamento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form_departamento" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/electron/cadastros/criar-departamento" site="rks-controller" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response)" dmx-on:success="form_departamento.reset();modal_departamento.hide();notificacoes.success('Departamento cadastrado com sucesso!')">
                    <div class="form-group mb-3"> <label for="nome_departamento_ipt" class="form-label">Nome do departamento</label>
                        <input type="text" class="form-control py-2" id="nome_departamento_ipt" name="nome_departamento_ipt" aria-describedby="input1_help">
                        <input id="empresa_dep_ref" name="empresa_dep_ref" type="hidden" class="form-control" dmx-bind:value="usuario_atual.data.query_usuario.empresa_selecionada">
                    </div>
                    <div class="form-group mb-3"> <label for="input2" class="form-label">Descrição</label>
                        <textarea id="descricao_departamento_ipt" class="form-control" name="descricao_departamento_ipt"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="form_departamento.submit()">Cadastrar</button>
            </div>
        </div>
    </div>
</div>
<header class="bg-black p-3">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col">
                <h4 class="text-light m-0 mb-1">Departamentos</h4>
                <p class="m-0 text-white-50 subtitulo">A nice paragraph</p>
            </div>
            <div class="col text-end">
                <button id="btn1" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal_departamento">Adicionar novo departamento</button>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid px-3 pt-4">
    <div class="row" is="dmx-repeat" id="repeat_departamentos" dmx-bind:repeat="listar_departamentos.data.query" key="dep_id">
        <div class="col-3">
            <div class="card bg-abstract shadow">
                <div class="card-body p-4">
                    <h4 class="card-title">{{nome_departamento}}</h4>
                    <p class="card-text">{{descricao_departamento}}</p>
                    <a href="#" class="btn btn-secondary"><i class="fa fa-pencil-square-o"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>