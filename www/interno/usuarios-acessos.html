<!-- Wappler include head-page="backoffice.html" is="dmx-app" id="usuariosacessos" appConnect="local" bootstrap5="local" capacitor="local" fontawesome_4="local" components="{dmxBootstrap5Modal:{},dmxValidator:{},dmxBootstrap5TableGenerator:{},dmxDataTraversal:{}}" -->




<dmx-serverconnect id="listar_usuarios" url="http://localhost:3000/api/electron/cadastros/listas-usuarios" site="rks-controller" dmx-param:id_empresa="usuario_atual.data.query_usuario.empresa_selecionada"></dmx-serverconnect>
<dmx-serverconnect id="desativar_usuario" noload="true" url="http://localhost:3000/api/electron/cadastros/desativar-usuario" site="rks-controller" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response+'. Entre em contato com o suporte.')" dmx-on:success="notificacoes.success('Usuário desativado com sucesso!')"></dmx-serverconnect><dmx-data-detail id="data_usuario" dmx-bind:data="listar_usuarios.data.query_usuarios.data" key="id_usuarios"></dmx-data-detail>
<div class="modal" id="modal_desativar" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" nokeyboard="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Desativar colaborador</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <i class="fa fa-exclamation-circle fa-4x text-danger mb-3"></i>
                <p class="text-center">Você está prestes a desativar o colaborador(a) <b>{{data_usuario.data.nome_completo}}</b>. Essa ação é irreversível. Para reativar, será necessário abrir um chamado de suporte. Deseja continuar?</p>
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-center w-100 gap-3"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="button" class="btn btn-danger" dmx-on:click="listar_usuarios.load({id_empresa: usuario_atual.data.query_usuario.empresa_selecionada});desativar_usuario.load({id_usuario: data_usuario.data.id_usuarios, id_empresa: usuario_atual.data.query_usuario.empresa_selecionada});modal_desativar.hide();data_usuario.select(0)">Sim! Quero continuar!</button></div>


            </div>
        </div>
    </div>
</div>
<div class="modal" id="modalUusuarios" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" nokeyboard="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cadastro de usuário</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="form_cadastrar_usuario.reset()"></button>
            </div>
            <div class="modal-body">
                <form id="form_cadastrar_usuario" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/electron/cadastros/cadastrar-usuario" site="rks-controller" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response)" dmx-on:success="form_cadastrar_usuario.reset();modalUusuarios.hide();notificacoes.success(form_cadastrar_usuario.data.resposta)">
                    <div class="form-group mb-3"> <label for="nome_completo_ipt" class="form-label">Nome completo</label>
                        <input type="text" class="form-control py-2" id="nome_completo_ipt" name="nome_completo_ipt" aria-describedby="input1_help" required="" data-msg-required="Este é um campo obrigatório!">
                        <input type="hidden" class="form-control py-2" id="empresa_ipt" name="empresa_ipt" aria-describedby="input1_help" dmx-bind:value="usuario_atual.data.query_usuario.empresa_selecionada">
                    </div>
                    <div class="form-group mb-3"> <label for="cpf_ipt" class="form-label">CPF</label>
                        <input type="text" class="form-control py-2" id="cpf_ipt" name="cpf_ipt" aria-describedby="input1_help1" required="" data-msg-required="Este é um campo obrigatório!">
                    </div>
                    <div class="form-group mb-3"> <label for="email_ipt" class="form-label">E-mail</label>
                        <input type="email" class="form-control py-2" id="email_ipt" name="email_ipt" aria-describedby="input1_help2" required="" data-msg-required="Este é um campo obrigatório!" data-rule-email="" data-msg-email="Insira um e-mail válido.">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" dmx-on:click="form_cadastrar_usuario.reset();modalUusuarios.hide()">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="form_cadastrar_usuario.submit()">Cadastrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="modalEditarUsuarios" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" nokeyboard="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Atualizar usuário</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="data_usuario.select(0);form_atualizar_usuario.reset()"></button>
            </div>
            <div class="modal-body">
                <form id="form_atualizar_usuario" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/electron/cadastros/atualizar-usuario" site="rks-controller" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response)" dmx-on:success="listar_usuarios.load({id_empresa: usuario_atual.data.query_usuario.empresa_selecionada});data_usuario.select(0);form_atualizar_usuario.reset();modalEditarUsuarios.hide();notificacoes.success('Usuario atualizado com sucesso!')">
                    <div class="form-group mb-3"> <label for="nome_edit_completo_ipt" class="form-label">Nome completo</label>
                        <input type="text" class="form-control py-2" id="nome_edit_completo_ipt" name="nome_edit_completo_ipt" aria-describedby="input1_help" required="" data-msg-required="Este é um campo obrigatório!" dmx-bind:value="data_usuario.data.nome_completo">
                        <input type="hidden" class="form-control py-2" id="usuario_edit_ipt" name="usuario_edit_ipt" aria-describedby="input1_help" dmx-bind:value="data_usuario.data.id_usuarios">
                    </div>
                    <div class="form-group mb-3"> <label for="cpf_edit_ipt" class="form-label">CPF</label>
                        <input type="text" class="form-control py-2" id="cpf_edit_ipt" name="cpf_edit_ipt" aria-describedby="input1_help1" required="" data-msg-required="Este é um campo obrigatório!" dmx-bind:value="data_usuario.data.cpf">
                    </div>
                    <div class="form-group mb-3"> <label for="email_edit_ipt" class="form-label">E-mail</label>
                        <input type="email" class="form-control py-2" id="email_edit_ipt" name="email_edit_ipt" aria-describedby="input1_help2" required="" data-msg-required="Este é um campo obrigatório!" data-rule-email="" data-msg-email="Insira um e-mail válido." dmx-bind:value="data_usuario.data['e-mail']">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" dmx-on:click="form_atualizar_usuario.reset();data_usuario.select(0);modalEditarUsuarios.hide()">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="form_atualizar_usuario.submit()">Atualizar</button>
            </div>
        </div>
    </div>
</div>
<header class="mb-4">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col">
                <h4 class="m-0 mb-1">Usuários</h4>
            </div>
            <div class="col text-end">
                <button id="btn1" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalUusuarios">Adicionar novo usuário</button>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid">
    <div class="row">
        <div class="col p-4 rounded-3 bg-white">
            <table class="table">
                <thead>
                    <tr>
                        <th class="titulo-tabela pb-3 bg-white">Nome completo</th>
                        <th class="titulo-tabela pb-3 bg-white">Cpf</th>
                        <th class="titulo-tabela pb-3 bg-white">E mail</th>
                        <th class="titulo-tabela pb-3 bg-white">Status</th>
                        <th scope="row" class="titulo-tabela pb-3 bg-white text-end">Ações</th>
                    </tr>
                </thead>
                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="listar_usuarios.data.query_usuarios.data" id="tableRepeat1">
                    <tr>
                        <td class="py-3 texto-tabela" dmx-text="nome_completo"></td>
                        <td class="py-3 texto-tabela-secundario" dmx-text="cpf"></td>
                        <td class="py-3 texto-tabela-secundario" dmx-text="$value['e-mail']"></td>
                        <td class="py-3 texto-tabela-secundario"><span dmx-text="status_use" class="badge texto-tabela" dmx-class:text-bg-success="status_use == 'Ativo'" dmx-class:text-bg-warning="status_use == 'Inativo'"></span></td>
                        <td class="py-3 text-end">

                            <div class="dropdown">
                                <button id="dropdown1" class="btn dropdown-toggle btn-sm btn-light" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" dmx-show="status_use=='Ativo'">Ações&nbsp;</button>
                                <div class="dropdown-menu" aria-labelledby="dropdown1">
                                    <button id="btn2" class="btn w-100 text-start text-primary" data-bs-toggle="modal" data-bs-target="#modalEditarUsuarios" dmx-on:click="data_usuario.select(id_usuarios)">Editar</button>
                                    <button id="btn3" class="btn w-100 text-start text-danger" data-bs-toggle="modal" data-bs-target="#modal_desativar" dmx-on:click="data_usuario.select(id_usuarios)">Desativar</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            </table>
        </div>
    </div>
</div>