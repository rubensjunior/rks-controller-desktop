{"version":3,"sources":["components/queryManager.js","components/cookieManager.js","components/localManager.js","components/sessionManager.js"],"names":["dmx","Component","initialData","data","methods","set","key","value","this","_setQueryParam","remove","removeAll","render","init","_updateHandler","bind","window","addEventListener","nextTick","initContentView","contentView","app","find","destroy","removeEventListener","updated","params","clone","url","URL","location","search","URLSearchParams","history","pushState","_buildQuery","keys","Object","length","reduce","query","encodeURIComponent","_parseQuery","replace","split","part","p","decodeURIComponent","loading","_cookie","document","cookie","_getCookie","name","options","_setCookie","expires","forEach","pos","indexOf","substr","test","path","String","escape","Date","now","toUTCString","domain","secure","val","JSON","stringify","localStorage","setItem","removeItem","_getData","startsWith","slice","parse","getItem","e","console","warn","sessionStorage","node"],"mappings":";;;;;;AAAAA,IAAAC,UAAA,gBAAA,CAEAC,YAAA,CACAC,KAAA,CAAA,GAGAC,QAAA,CACA,GAAAC,CAAAC,EAAAC,GACAC,KAAAC,eAAAH,EAAAC,EACA,EAEA,MAAAG,CAAAJ,GACAE,KAAAC,eAAAH,EACA,EAEA,SAAAK,GACAH,KAAAC,gBACA,GAGAG,QAAA,EAEA,IAAAC,GACAL,KAAAM,eAAAN,KAAAM,eAAAC,KAAAP,MAGAQ,OAAAC,iBAAA,WAAAT,KAAAM,gBACAE,OAAAC,iBAAA,YAAAT,KAAAM,gBACAE,OAAAC,iBAAA,eAAAT,KAAAM,gBAEAd,IAAAkB,SAAA,KAEAV,KAAAW,oBAGAX,KAAAM,gBACA,EAEA,eAAAK,GACAX,KAAAY,YAAApB,IAAAqB,KAAAC,KAAA,WACAd,KAAAY,aAAAH,iBAAA,OAAAT,KAAAM,eACA,EAEA,OAAAS,GACAP,OAAAQ,oBAAA,WAAAhB,KAAAM,gBACAE,OAAAQ,oBAAA,YAAAhB,KAAAM,gBACAE,OAAAQ,oBAAA,eAAAhB,KAAAM,gBACAN,KAAAY,aAAAI,oBAAA,OAAAhB,KAAAM,eACA,EAEAL,eAAA,SAAAH,EAAAC,GACA,IAAAkB,GAAA,EACAC,EAAA1B,IAAA2B,MAAAnB,KAAAL,KAAAA,MAeA,GAbA,MAAAI,EACA,MAAAD,GACAoB,EAAA,CAAA,EACAD,GAAA,GACAC,EAAApB,YACAoB,EAAApB,GACAmB,GAAA,GAEAC,EAAApB,IAAAC,IACAmB,EAAApB,GAAAC,EACAkB,GAAA,GAGAA,EAAA,CACA,MAAAG,EAAA,IAAAC,IAAAb,OAAAc,UACAF,EAAAG,OAAA,IAAAC,gBAAAN,GACAV,OAAAiB,QAAAC,UAAA,KAAA,KAAAN,EACA,CACA,EAEAO,YAAA,SAAAhC,GACA,MAAAiC,EAAAC,OAAAD,KAAAjC,GAEA,OAAAiC,EAAAE,OACA,IACAF,EAAAG,OAAA,SAAAC,EAAAlC,GAGA,OAFAkC,IAAAA,GAAA,KACAA,GAAAC,mBAAAnC,GAAA,IAAAmC,mBAAAtC,EAAAG,GAEA,EAAA,IACA,EACA,EAEAoC,YAAA,WAGA,OAFAlC,KAAAuB,OAAAY,QAAA,MAAA,IAEAC,MAAA,KAAAL,OAAA,SAAApC,EAAA0C,GACA,MAAAC,EAAAD,EAAAF,QAAA,MAAA,KAAAC,MAAA,KAEA,OADAE,EAAA,KAAA3C,EAAA4C,mBAAAD,EAAA,KAAAC,mBAAAD,EAAA,IAAA,KACA3C,CACA,EAAA,CAAA,EACA,EAEA,cAAAW,GACAN,KAAAY,aAAAjB,MAAA6C,SAEAxC,KAAAuB,SAAAf,OAAAc,SAAAC,SACAvB,KAAAuB,OAAAf,OAAAc,SAAAC,OACAvB,KAAAH,IAAA,OAAAG,KAAAkC,eAEA,ICxGA1C,IAAAC,UAAA,iBAAA,CAEA,WAAAC,GAGA,OAFAM,KAAAyC,QAAAC,SAAAC,OAEA,CACAhD,KAAAK,KAAA4C,aAEA,EAEAhD,QAAA,CACA,GAAAC,CAAAgD,EAAA9C,EAAA+C,EAAA,CAAA,GACA9C,KAAA+C,WAAAF,EAAA9C,EAAA+C,EACA,EAEA,MAAA5C,CAAA2C,EAAAC,EAAA,CAAA,GACAA,EAAAE,QAAA,uBACAhD,KAAA+C,WAAAF,EAAA,GAAAC,EACA,EAEA,SAAA3C,CAAA2C,EAAA,CAAA,GACAA,EAAAE,QAAA,uBACAnB,OAAAD,KAAA5B,KAAAL,KAAAA,MAAAsD,QAAA,SAAAJ,GACA7C,KAAA+C,WAAAF,EAAA,GAAAC,EACA,EACA,GAGA1C,QAAA,EAEA,UAAAwC,GACA,OAAA5C,KAAAyC,QAAAL,MAAA,QAAAL,OAAA,SAAApC,EAAAgD,GACA,IAAAO,EAAAP,EAAAQ,QAAA,KAEA,OADAxD,EAAA4C,mBAAAI,EAAAS,OAAA,EAAAF,KAAAX,mBAAAI,EAAAS,OAAAF,EAAA,IACAvD,CACA,EAAA,CAAA,EACA,EAEAoD,WAAA,SAAAF,EAAA9C,EAAA+C,GACA,IAAAD,GAAA,6CAAAQ,KAAAR,GACA,OAAA,GAGAC,EAAAA,GAAA,CAAA,GACAQ,KAAAR,EAAAQ,MAAA,IAWA,IAAAX,GALAE,GADAA,GADAA,EAAAZ,mBAAAsB,OAAAV,KACAV,QAAA,2BAAAI,qBACAJ,QAAA,UAAAqB,SAKA,KAFAzD,GADAA,EAAAkC,mBAAAsB,OAAAxD,KACAoC,QAAA,4DAAAI,qBAIAO,EAAAE,UACA,iBAAAF,EAAAE,UACAF,EAAAE,QAAAS,KAAAC,MAAA,MAAAZ,EAAAE,SAEAL,GAAA,aAAA,IAAAc,KAAAX,EAAAE,SAAAW,eAGAb,EAAAc,SACAjB,GAAA,YAAAG,EAAAc,QAGAd,EAAAQ,OACAX,GAAA,UAAAG,EAAAQ,MAGAR,EAAAe,SACAlB,GAAA,YAGAD,SAAAC,OAAAA,EAEA3C,KAAAyC,QAAAC,SAAAC,OACA3C,KAAAH,IAAA,OAAAG,KAAA4C,aACA,IChFApD,IAAAC,UAAA,gBAAA,CAEAC,YAAA,CACAC,KAAA,CAAA,GAGAC,QAAA,CACA,GAAAC,CAAAC,EAAAC,GACA,MAAA+D,EAAAC,KAAAC,UAAAjE,GACA,MAAA+D,EACAtD,OAAAyD,aAAAC,QAAA,YAAApE,EAAAgE,GAEAtD,OAAAyD,aAAAE,WAAA,YAAArE,GAEAE,KAAAoE,UACA,EAEA,MAAAlE,CAAAJ,GACAU,OAAAyD,aAAAE,WAAA,YAAArE,GACAE,KAAAoE,UACA,EAEA,SAAAjE,GACA0B,OAAAD,KAAApB,OAAAyD,cAAAhB,QAAA,SAAAnD,GACAA,EAAAuE,WAAA,cACA7D,OAAAyD,aAAAE,WAAArE,EAEA,GACAE,KAAAoE,UACA,GAGAhE,QAAA,EAEA,IAAAC,GACAL,KAAAoE,UACA,EAEA,QAAAA,GACApE,KAAAH,IACA,OACAgC,OAAAD,KAAApB,OAAAyD,cAAAlC,OAAA,SAAApC,EAAAG,GACA,GAAAA,EAAAuE,WAAA,aACA,IACA1E,EAAAG,EAAAwE,MAAA,IAAAP,KAAAQ,MAAA/D,OAAAyD,aAAAO,QAAA1E,GACA,CAAA,MAAA2E,GACAC,QAAAC,KAAA,uBAAAnE,OAAAyD,aAAAO,QAAA1E,GACA,CAGA,OAAAH,CACA,EAAA,CAAA,GAEA,ICrDAH,IAAAC,UAAA,kBAAA,CAEAC,YAAA,CACAC,KAAA,CAAA,GAGAC,QAAA,CACA,GAAAC,CAAAC,EAAAC,GACA,MAAA+D,EAAAC,KAAAC,UAAAjE,GACA,MAAA+D,EACAtD,OAAAoE,eAAAV,QAAA,YAAApE,EAAAgE,GAEAtD,OAAAoE,eAAAT,WAAA,YAAArE,GAEAE,KAAAoE,UACA,EAEA,MAAAlE,CAAAJ,GACAU,OAAAoE,eAAAT,WAAA,YAAArE,GACAE,KAAAoE,UACA,EAEA,SAAAjE,GACA0B,OAAAD,KAAApB,OAAAoE,gBAAA3B,QAAA,SAAAnD,GACAA,EAAAuE,WAAA,cACA7D,OAAAoE,eAAAT,WAAArE,EAEA,GACAE,KAAAoE,UACA,GAGAhE,QAAA,EAEA,IAAAC,CAAAwE,GACA7E,KAAAoE,UACA,EAEA,QAAAA,GACApE,KAAAH,IACA,OACAgC,OAAAD,KAAApB,OAAAoE,gBAAA7C,OAAA,SAAApC,EAAAG,GACA,GAAAA,EAAAuE,WAAA,aACA,IACA1E,EAAAG,EAAAwE,MAAA,IAAAP,KAAAQ,MAAA/D,OAAAoE,eAAAJ,QAAA1E,GACA,CAAA,MAAA2E,GACAC,QAAAC,KAAA,uBAAAnE,OAAAoE,eAAAJ,QAAA1E,GACA,CAGA,OAAAH,CACA,EAAA,CAAA,GAEA","file":"dmxStateManagement.js","sourcesContent":["dmx.Component('query-manager', {\r\n\r\n  initialData: {\r\n    data: {},\r\n  },\r\n\r\n  methods: {\r\n    set (key, value) {\r\n      this._setQueryParam(key, value);\r\n    },\r\n\r\n    remove (key) {\r\n      this._setQueryParam(key);\r\n    },\r\n\r\n    removeAll () {\r\n      this._setQueryParam();\r\n    },\r\n  },\r\n\r\n  render: false,\r\n\r\n  init () {\r\n    this._updateHandler = this._updateHandler.bind(this);\r\n\r\n    // only need to update on these events\r\n    window.addEventListener('popstate', this._updateHandler);\r\n    window.addEventListener('pushstate', this._updateHandler);\r\n    window.addEventListener('replacestate', this._updateHandler);\r\n\r\n    dmx.nextTick(() => {\r\n      // need to wait for all components to be initialized/rendered\r\n      this.initContentView();\r\n    });\r\n\r\n    this._updateHandler();\r\n  },\r\n\r\n  initContentView () {\r\n    this.contentView = dmx.app?.find('content');\r\n    this.contentView?.addEventListener('load', this._updateHandler);\r\n  },\r\n\r\n  destroy () {\r\n    window.removeEventListener('popstate', this._updateHandler);\r\n    window.removeEventListener('pushstate', this._updateHandler);\r\n    window.removeEventListener('replacestate', this._updateHandler);\r\n    this.contentView?.removeEventListener('load', this._updateHandler);\r\n  },\r\n\r\n  _setQueryParam: function (key, value) {\r\n    let updated = false;\r\n    let params = dmx.clone(this.data.data);\r\n\r\n    if (value == null) {\r\n      if (key == null) {\r\n        params = {};\r\n        updated = true;\r\n      } else if (params[key]) {\r\n        delete params[key];\r\n        updated = true;\r\n      }\r\n    } else if (params[key] != value) {\r\n      params[key] = value;\r\n      updated = true;\r\n    }\r\n\r\n    if (updated) {\r\n      const url = new URL(window.location);\r\n      url.search = new URLSearchParams(params);\r\n      window.history.pushState(null, null, url);\r\n    }\r\n  },\r\n\r\n  _buildQuery: function (data) {\r\n    const keys = Object.keys(data);\r\n\r\n    return keys.length\r\n      ? '?' +\r\n          keys.reduce(function (query, key) {\r\n            if (query) query += '&';\r\n            query += encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);\r\n            return query;\r\n          }, '')\r\n      : '';\r\n  },\r\n\r\n  _parseQuery: function () {\r\n    const query = this.search.replace(/^\\?/, '');\r\n\r\n    return query.split('&').reduce(function (data, part) {\r\n      const p = part.replace(/\\+/g, ' ').split('=');\r\n      if (p[0]) data[decodeURIComponent(p[0])] = decodeURIComponent(p[1] || '');\r\n      return data;\r\n    }, {});\r\n  },\r\n\r\n  _updateHandler () {\r\n    if (this.contentView?.data?.loading) return;\r\n\r\n    if (this.search !== window.location.search) {\r\n      this.search = window.location.search;\r\n      this.set('data', this._parseQuery());\r\n    }\r\n  },\r\n\r\n});\r\n","dmx.Component('cookie-manager', {\r\n\r\n  initialData () {\r\n    this._cookie = document.cookie;\r\n\r\n    return {\r\n      data: this._getCookie(),\r\n    };\r\n  },\r\n\r\n  methods: {\r\n    set (name, value, options = {}) {\r\n      this._setCookie(name, value, options);\r\n    },\r\n\r\n    remove (name, options = {}) {\r\n      options.expires = '1970-01-01T00:00:00Z';\r\n      this._setCookie(name, '', options);\r\n    },\r\n\r\n    removeAll (options = {}) {\r\n      options.expires = '1970-01-01T00:00:00Z';\r\n      Object.keys(this.data.data).forEach(function (name) {\r\n        this._setCookie(name, '', options);\r\n      });\r\n    },\r\n  },\r\n\r\n  render: false,\r\n\r\n  _getCookie () {\r\n    return this._cookie.split(/;\\s*/).reduce(function (data, cookie) {\r\n      var pos = cookie.indexOf('=');\r\n      data[decodeURIComponent(cookie.substr(0, pos))] = decodeURIComponent(cookie.substr(pos + 1));\r\n      return data;\r\n    }, {});\r\n  },\r\n\r\n  _setCookie: function (name, value, options) {\r\n    if (!name || /^(?:expires|max\\-age|path|domain|secure)$/i.test(name)) {\r\n      return false;\r\n    }\r\n\r\n    options = options || {};\r\n    options.path = options.path || '/';\r\n\r\n    // escaping taken from:\r\n    // https://github.com/js-cookie/js-cookie/blob/master/src/js.cookie.js\r\n    name = encodeURIComponent(String(name));\r\n    name = name.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\r\n    name = name.replace(/[\\(\\)]/g, escape);\r\n\r\n    value = encodeURIComponent(String(value));\r\n    value = value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\r\n\r\n    var cookie = name + '=' + value;\r\n\r\n    if (options.expires) {\r\n      if (typeof options.expires == 'number') {\r\n        options.expires = Date.now() + options.expires * 86400000;\r\n      }\r\n      cookie += '; expires=' + new Date(options.expires).toUTCString();\r\n    }\r\n\r\n    if (options.domain) {\r\n      cookie += '; domain=' + options.domain;\r\n    }\r\n\r\n    if (options.path) {\r\n      cookie += '; path=' + options.path;\r\n    }\r\n\r\n    if (options.secure) {\r\n      cookie += '; secure';\r\n    }\r\n\r\n    document.cookie = cookie;\r\n\r\n    this._cookie = document.cookie;\r\n    this.set('data', this._getCookie());\r\n  },\r\n\r\n});\r\n","dmx.Component('local-manager', {\r\n\r\n  initialData: {\r\n    data: {},\r\n  },\r\n\r\n  methods: {\r\n    set (key, value) {\r\n      const val = JSON.stringify(value);\r\n      if (val != null) {\r\n        window.localStorage.setItem('dmxState-' + key, val);\r\n      } else {\r\n        window.localStorage.removeItem('dmxState-' + key);\r\n      }\r\n      this._getData();\r\n    },\r\n\r\n    remove (key) {\r\n      window.localStorage.removeItem('dmxState-' + key);\r\n      this._getData();\r\n    },\r\n\r\n    removeAll () {\r\n      Object.keys(window.localStorage).forEach(function (key) {\r\n        if (key.startsWith('dmxState-')) {\r\n          window.localStorage.removeItem(key);\r\n        }\r\n      });\r\n      this._getData();\r\n    },\r\n  },\r\n\r\n  render: false,\r\n\r\n  init () {\r\n    this._getData();\r\n  },\r\n\r\n  _getData () {\r\n    this.set(\r\n      'data',\r\n      Object.keys(window.localStorage).reduce(function (data, key) {\r\n        if (key.startsWith('dmxState-')) {\r\n          try {\r\n            data[key.slice(9)] = JSON.parse(window.localStorage.getItem(key));\r\n          } catch (e) {\r\n            console.warn('Error parsing JSON: ' + window.localStorage.getItem(key));\r\n          }\r\n        }\r\n\r\n        return data;\r\n      }, {})\r\n    );\r\n  },\r\n});\r\n","dmx.Component('session-manager', {\r\n\r\n  initialData: {\r\n    data: {},\r\n  },\r\n\r\n  methods: {\r\n    set (key, value) {\r\n      const val = JSON.stringify(value);\r\n      if (val != null) {\r\n        window.sessionStorage.setItem('dmxState-' + key, val);\r\n      } else {\r\n        window.sessionStorage.removeItem('dmxState-' + key);\r\n      }\r\n      this._getData();\r\n    },\r\n\r\n    remove (key) {\r\n      window.sessionStorage.removeItem('dmxState-' + key);\r\n      this._getData();\r\n    },\r\n\r\n    removeAll () {\r\n      Object.keys(window.sessionStorage).forEach(function (key) {\r\n        if (key.startsWith('dmxState-')) {\r\n          window.sessionStorage.removeItem(key);\r\n        }\r\n      });\r\n      this._getData();\r\n    },\r\n  },\r\n\r\n  render: false,\r\n\r\n  init (node) {\r\n    this._getData();\r\n  },\r\n\r\n  _getData () {\r\n    this.set(\r\n      'data',\r\n      Object.keys(window.sessionStorage).reduce(function (data, key) {\r\n        if (key.startsWith('dmxState-')) {\r\n          try {\r\n            data[key.slice(9)] = JSON.parse(window.sessionStorage.getItem(key));\r\n          } catch (e) {\r\n            console.warn('Error parsing JSON: ' + window.sessionStorage.getItem(key));\r\n          }\r\n        }\r\n\r\n        return data;\r\n      }, {})\r\n    );\r\n  },\r\n});\r\n"],"sourceRoot":"../../dmxStateManagement"}