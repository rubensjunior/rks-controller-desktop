{"version":3,"sources":["config/routing.js","core/routing.js","components/route.js","components/view.js","components/link.js"],"names":["dmx","config","mapping","settings","routing","router","base","routes","getRoutes","this","filter","route","app","name","getBase","document","querySelector","getAttribute","getUrlInfo","url","URL","window","location","hash","slice","origin","path","pathname","query","search","match","parent","replace","i","length","end","keys","pathToRegexp","join","exec","decodeURI","params","reduce","key","index","path1","path2","evalScripts","node","querySelectorAll","forEach","script","newScript","createElement","type","src","innerHTML","parentNode","replaceChild","e","console","error","Object","assign","Component","initialData","isExact","isMatch","loading","attributes","String","default","exact","Boolean","events","show","Event","hide","unauthorized","forbidden","notfound","render","init","_locationHandler","bind","_error","_cache","Map","_content","_keys","_re","props","_shown","addEventListener","destroy","removeEventListener","performUpdate","updatedProps","set","_load","_hide","has","_loaded","get","_show","_abortController","AbortController","fetch","credentials","signal","then","reponse","text","content","catch","abort","$node","$parse","dispatchEvent","effects","effect","$destroyChildren","err","debug","event","data","load","methods","force","reload","_reload","__WAPPLER__","_url","includes","headers","response","status","html","_parseQuery","warn","internal","href","_clickHandler","_stateHandler","setAttribute","_fixUrl","classList","contains","removeAttribute","startsWith","_navigate","title","history","pushState","ctrlKey","button","preventDefault","hasAttribute","active","split","toggle","items","remove","add"],"mappings":"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","file":"dmxRouting.js","sourcesContent":["dmx.config.mapping['a'] = 'link';\r\n","(() => {\r\n\r\n  const settings = dmx.routing;\r\n\r\n  dmx.routing = {\r\n    router: \"hybrid\", // hybrid (combined server/client routing), path or hash\r\n\r\n    base: \"\", // todo: use when router is path (when page is in a subfolder)\r\n\r\n    routes: [],\r\n\r\n    getRoutes () {\r\n      return this.routes.filter(function (route) {\r\n        return !route.app || route.app == dmx.app.name;\r\n      });\r\n    },\r\n\r\n    getBase () {\r\n      if (this.base) {\r\n        return this.base;\r\n      } else {\r\n        var base = document.querySelector(\"base[href]\");\r\n        if (base) return base.getAttribute(\"href\");\r\n      }\r\n\r\n      return \"\";\r\n    },\r\n\r\n    getUrlInfo () {\r\n      var url =\r\n        this.router == \"hash\"\r\n          ? new URL(window.location.hash.slice(2), window.location.origin)\r\n          : window.location;\r\n\r\n      return {\r\n        path: url.pathname || \"/\",\r\n        query: url.search.slice(1),\r\n        hash: url.hash.slice(1),\r\n      };\r\n    },\r\n\r\n    match (path, routes, parent) {\r\n      path = path || this.getUrlInfo().path;\r\n      routes = routes || this.getRoutes();\r\n\r\n      var base = dmx.routing.getBase();\r\n      if (base) {\r\n        path = path.replace(base, \"\").replace(/^\\/?/, \"/\");\r\n      }\r\n\r\n      for (var i = 0; i < routes.length; i++) {\r\n        if (routes[i].routes) {\r\n          routes[i].end = false;\r\n        }\r\n\r\n        var keys = [];\r\n        var re = dmx.pathToRegexp(\r\n          dmx.routing.join(\r\n            parent && parent.path ? parent.path : \"/\",\r\n            routes[i].path\r\n          ),\r\n          keys,\r\n          routes[i]\r\n        );\r\n        var match = re.exec(decodeURI(path));\r\n\r\n        if (match) {\r\n          return {\r\n            path: match[0],\r\n            params: keys.reduce(function (params, key, index) {\r\n              params[key.name] = match[index + 1];\r\n              return params;\r\n            }, {}),\r\n            url: routes[i].url,\r\n            routes: routes[i].routes || [],\r\n          };\r\n        }\r\n      }\r\n\r\n      return null;\r\n    },\r\n\r\n    join (path1, path2) {\r\n      return path1.replace(/\\/$/, \"\") + \"/\" + path2.replace(/^\\//, \"\");\r\n    },\r\n\r\n    evalScripts(node) {\r\n      try {\r\n        node.querySelectorAll('script[type=\"text/javascript\"],script:not([type])').forEach(script => {\r\n          try {\r\n            const newScript = document.createElement(\"script\");\r\n            newScript.type = \"text/javascript\";\r\n            if (script.src) newScript.src = script.src;\r\n            if (script.innerHTML) newScript.innerHTML = script.innerHTML;\r\n            script.parentNode.replaceChild(newScript, script);\r\n          } catch (e) {\r\n            console.error(\"Error executing script \" + script.src, e);\r\n          }\r\n        });\r\n      } catch (e) {\r\n        console.error(\"An error occurred while trying to execute scripts\", e);\r\n      }\r\n    },\r\n  };\r\n\r\n  if (settings) {\r\n    // merge settings\r\n    Object.assign(dmx.routing, settings);\r\n  }\r\n\r\n})();","dmx.Component('route', {\r\n\r\n  initialData: {\r\n    isExact: false,\r\n    isMatch: false,\r\n    loading: false,\r\n    params: {}, // Key/value pairs parsed from the URL corresponding to the dynamic segments of the path\r\n    path: '', // The path pattern used to match. Useful for building nested Routes\r\n    url: '',  // The matched portion of the URL. Useful for building nested Links\r\n  },\r\n\r\n  attributes: {\r\n    path: {\r\n      type: String,\r\n      default: '*',\r\n    },\r\n\r\n    exact: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    url: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n  },\r\n\r\n  events: {\r\n    show: Event,\r\n    hide: Event,\r\n    error: Event,\r\n    unauthorized: Event,\r\n    forbidden: Event,\r\n    notfound: Event,\r\n  },\r\n\r\n  render: false,\r\n\r\n  init (node) {\r\n    this._locationHandler = this._locationHandler.bind(this);\r\n    this._error = this._error.bind(this);\r\n\r\n    this._cache = new Map();\r\n    this._content = node.innerHTML;\r\n    this._keys = [];\r\n    this._re = dmx.pathToRegexp(this.props.path, this._keys, { end: this.props.exact });\r\n    this._shown = false;\r\n    \r\n    node.innerHTML = '';\r\n\r\n    window.addEventListener(\"popstate\", this._locationHandler);\r\n    window.addEventListener(\"pushstate\", this._locationHandler);\r\n    window.addEventListener(\"replacestate\", this._locationHandler);\r\n    window.addEventListener('hashchange', this._locationHandler);\r\n\r\n    this._locationHandler();\r\n  },\r\n\r\n  destroy () {\r\n    window.removeEventListener(\"popstate\", this._locationHandler);\r\n    window.removeEventListener(\"pushstate\", this._locationHandler);\r\n    window.removeEventListener(\"replacestate\", this._locationHandler);\r\n    window.removeEventListener('hashchange', this._locationHandler);\r\n  },\r\n\r\n  performUpdate (updatedProps) {\r\n    this.set({\r\n      path: this.props.path,\r\n      isExact: this.props.exact,\r\n    });\r\n  },\r\n\r\n  _load () {\r\n    this._hide();\r\n\r\n    const url = this.props.url;\r\n\r\n    if (this._cache.has(url)) {\r\n      this._loaded = url;\r\n      this._content = this._cache.get(url);\r\n      this._show();\r\n      return;\r\n    }\r\n\r\n    this.set('loading', true);\r\n\r\n    this._abortController = new AbortController();\r\n\r\n    fetch(url, {\r\n      credentials: 'same-origin',\r\n      signal: this._abortController.signal,\r\n    }).then(reponse => reponse.text()).then(content => {\r\n      this.set('loading', false);\r\n      this._loaded = url;\r\n      this._content = content;\r\n      this._cache.set(url, content);\r\n      this._show();\r\n    }).catch(this._error);\r\n  },\r\n\r\n  _show () {\r\n    if (this._shown) return;\r\n\r\n    if (this._abortController) {\r\n      this._abortController.abort();\r\n    }\r\n\r\n    this.$node.innerHTML = this._content;\r\n    this.$parse();\r\n    \r\n    dmx.routing.evalScripts(this.$node);\r\n\r\n    this._shown = true;\r\n    this.dispatchEvent('show');\r\n  },\r\n\r\n  _hide () {\r\n    if (!this._shown) return;\r\n\r\n    if (this._abortController) {\r\n      this._abortController.abort();\r\n    }\r\n\r\n    if (this.effects) {\r\n      this.effects.forEach((effect) => effect());\r\n      this.effects = null;\r\n    }\r\n    this.$destroyChildren();\r\n    this.$node.innerHTML = '';\r\n\r\n    this._shown = false;\r\n    this.dispatchEvent('hide');\r\n  },\r\n\r\n  _error (err) {\r\n    this.set('loading', false);\r\n    this.dispatchEvent('error');\r\n    if (dmx.debug) console.error(err);\r\n  },\r\n\r\n  _locationHandler (event) {\r\n    let path = dmx.routing.getUrlInfo().path;\r\n\r\n    if (dmx.routing.router == 'hybrid') {\r\n      let base = document.querySelector('meta[name=\"ac:base\"]');\r\n      let route = document.querySelector('meta[name=\"ac:route\"]');\r\n\r\n      if (base && base.content) {\r\n        path = path.replace(base.content.replace(/\\/$/, ''), '');\r\n      }\r\n\r\n      if (route && route.content) {\r\n        path = path.replace(dmx.pathToRegexp(route.content, [], { end: false }), '').replace(/^(\\/+)?/, '/');\r\n      }\r\n    }\r\n\r\n    const match = this._re.exec(path);\r\n\r\n    if (match) {\r\n      this.set({\r\n        isMatch: true,\r\n        url: match[0],\r\n        params: this._keys.reduce((params, key, index) => {\r\n          params[key.name] = match[index + 1];\r\n          return params;\r\n        }, {})\r\n      });\r\n\r\n      if (this.data.loading && this.props.url === this._loaded) {\r\n        // Url is loading\r\n        return;\r\n      }\r\n\r\n      if (this.props.url && this.props.url !== this._loaded) {\r\n        this._load();\r\n      } else {\r\n        this._show();\r\n      }\r\n    } else {\r\n      this.set({\r\n        isMatch: false,\r\n        url: '',\r\n        params: {},\r\n      });\r\n\r\n      this._hide();\r\n    }\r\n  },\r\n\r\n});\r\n","dmx.Component(\"view\", {\r\n\r\n  initialData: {\r\n    loading: false,\r\n    params: null,\r\n  },\r\n\r\n  events: {\r\n    load: Event,\r\n    error: Event,\r\n    unauthorized: Event,\r\n    forbidden: Event,\r\n    notfound: Event,\r\n  },\r\n\r\n  methods: {\r\n    load (url, force) {\r\n      this._load(url, force);\r\n    },\r\n\r\n    reload () {\r\n      this._reload();\r\n    },\r\n  },\r\n\r\n  init (node) {\r\n    if (window.__WAPPLER__) return;\r\n\r\n    this._locationHandler = this._locationHandler.bind(this);\r\n\r\n    window.addEventListener(\"popstate\", this._locationHandler);\r\n    window.addEventListener(\"pushstate\", this._locationHandler);\r\n    window.addEventListener(\"replacestate\", this._locationHandler);\r\n    window.addEventListener('hashchange', this._locationHandler);\r\n\r\n    if (dmx.routing.router == \"hybrid\") {\r\n      this._url = location.pathname;\r\n    } else {\r\n      this._locationHandler();\r\n    }\r\n  },\r\n\r\n  destroy () {\r\n    window.removeEventListener(\"popstate\", this._locationHandler);\r\n    window.removeEventListener(\"pushstate\", this._locationHandler);\r\n    window.removeEventListener(\"replacestate\", this._locationHandler);\r\n    window.removeEventListener('hashchange', this._locationHandler);\r\n  },\r\n\r\n  _reload () {\r\n    this._load(this._url, true);\r\n  },\r\n\r\n  _load (url, force) {\r\n    if (this._url == url && this.data.loading) {\r\n      // Url is loading\r\n      return;\r\n    }\r\n\r\n    if (this._url != url || force) {\r\n      this.set(\"loading\", true);\r\n      this._url = url;\r\n\r\n      if (this._abortController) {\r\n        this._abortController.abort();\r\n      }\r\n\r\n      this._abortController = new AbortController();\r\n\r\n      fetch(url + (url.includes(\"?\") ? \"&\" : \"?\") + \"fragment=true\", {\r\n        credentials: 'same-origin',\r\n        headers: [['Accept', 'text/fragment+html']],\r\n        signal: this._abortController.signal,\r\n      }).then(response => {\r\n        this.set(\"loading\", false);\r\n\r\n        if (response.status == 200 || response.status == 0) {\r\n          response.text().then(html => {\r\n            this._show(html)\r\n            this.dispatchEvent(\"load\");\r\n            //window.dispatchEvent(new Event('load'));\r\n            dmx.app._parseQuery();\r\n          }).catch(err => {\r\n            console.error(err);\r\n            this.dispatchEvent('error')\r\n          });\r\n        } else {\r\n          if (response.status == 222) {\r\n            response.text().then(url => {\r\n              location.assign(url);\r\n            }).catch(err => {\r\n              console.error(err);\r\n              this.dispatchEvent('error')\r\n            });\r\n          } else {\r\n            const events = { 401: 'unauthorized', 403: 'forbidden', 404: 'notfound' };\r\n            this.dispatchEvent(events[response.status] || 'error');\r\n          }\r\n        }\r\n      }).catch(err => {\r\n        console.error(err);\r\n        this.set(\"loading\", false);\r\n        this.dispatchEvent('error');\r\n      });\r\n    }\r\n  },\r\n\r\n  _show (html) {\r\n    if (this.effects) {\r\n      this.effects.forEach((effect) => effect());\r\n      this.effects = null;\r\n    }\r\n\r\n    this.$destroyChildren();\r\n    this.$node.innerHTML = html;\r\n    this.$parse();\r\n\r\n    dmx.routing.evalScripts(this.$node);\r\n  },\r\n\r\n  _locationHandler (event) {\r\n    if (dmx.routing.router == \"hybrid\") {\r\n      this._load(location.pathname);\r\n    } else {\r\n      let path = dmx.routing.getUrlInfo().path;\r\n      let routes = dmx.routing.getRoutes();\r\n      let parent = this.parent;\r\n\r\n      while (parent) {\r\n        if (parent.routes) {\r\n          routes = parent.routes;\r\n          break;\r\n        }\r\n\r\n        parent = parent.parent;\r\n      }\r\n\r\n      const route = dmx.routing.match(path, routes, parent);\r\n\r\n      if (route) {\r\n        this.path = route.path;\r\n        this.routes = route.routes;\r\n        this.set(\"params\", route.params);\r\n        this._load(route.url);\r\n      } else {\r\n        console.warn(\"Route for \" + path + \" not found\");\r\n      }\r\n    }\r\n  },\r\n\r\n});\r\n","dmx.Component('link', {\r\n\r\n  attributes: {\r\n    internal: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    href: {\r\n      type: String,\r\n      default: null,\r\n    },\r\n  },\r\n\r\n  init (node) {\r\n    this._clickHandler = this._clickHandler.bind(this);\r\n    this._stateHandler = this._stateHandler.bind(this);\r\n\r\n    node.addEventListener('click', this._clickHandler);\r\n\r\n    if (this.props.href) {\r\n      this.$node.setAttribute('href', this.props.href);\r\n      this._fixUrl(node.getAttribute('href'));\r\n    }\r\n\r\n    if (node.classList.contains('nav-link')) {\r\n      window.addEventListener(\"popstate\", this._stateHandler);\r\n      window.addEventListener(\"pushstate\", this._stateHandler);\r\n      window.addEventListener(\"replacestate\", this._stateHandler);\r\n      window.addEventListener('hashchange', this._stateHandler);\r\n      this._stateHandler();\r\n    }\r\n  },\r\n\r\n  performUpdate (updatedProps) {\r\n    if (updatedProps.has('href')) {\r\n      if (this.props.href) {\r\n        this.$node.setAttribute('href', this.props.href);\r\n        this._fixUrl(this.props.href);\r\n      } else {\r\n        this.$node.removeAttribute('href');\r\n      }\r\n    }\r\n  },\r\n\r\n  destroy () {\r\n    this.$node.removeEventListener('click', this._clickHandler);\r\n    window.removeEventListener(\"popstate\", this._stateHandler);\r\n    window.removeEventListener(\"pushstate\", this._stateHandler);\r\n    window.removeEventListener(\"replacestate\", this._stateHandler);\r\n    window.removeEventListener('hashchange', this._stateHandler);\r\n  },\r\n\r\n  _fixUrl (url) {\r\n    if (url.startsWith('./')) {\r\n      let parent = this.parent;\r\n\r\n      while (parent) {\r\n        if (parent.routes && parent.path) {\r\n          url = dmx.routing.join('./', url.replace('./', parent.path));\r\n          break;\r\n        }\r\n\r\n        parent = parent.parent;\r\n      }\r\n\r\n      let route = document.querySelector('meta[name=\"ac:route\"]');\r\n      if (route && route.content) {\r\n        let path = route.content;\r\n        let base = document.querySelector('meta[name=\"ac:base\"]');\r\n        if (base && base.content) {\r\n          path = base.content.replace(/\\/$/, '') + path;\r\n        }\r\n        let match = dmx.pathToRegexp(path, [], { end: false }).exec(location.pathname);\r\n        if (match) {\r\n          this.$node.setAttribute('href', url.replace('./', match[0].replace(/(\\/+)?$/, '/')));\r\n        }\r\n      } else {\r\n        this.$node.setAttribute('href', dmx.routing.join(dmx.routing.getBase(), url));\r\n      }\r\n\r\n      this.props.internal = true;\r\n    }\r\n  },\r\n\r\n  _navigate (url) {\r\n    if (url.startsWith('#')) {\r\n      location.hash = url;\r\n      return;\r\n    }\r\n\r\n    if (dmx.routing.router === 'hash') {\r\n      url = '#!' + url;\r\n    }\r\n\r\n    const title = this.$node.title;\r\n    history.pushState({ title: title || document.title }, '', url);\r\n    if (title) document.title = title;\r\n    window.dispatchEvent(new Event('pushstate'));\r\n  },\r\n\r\n  _clickHandler (event) {\r\n    const url = this.$node.getAttribute('href');\r\n\r\n    if (url && (this.props.internal || url.startsWith('#')) && !event.ctrlKey && event.button === 0) {\r\n      event.preventDefault();\r\n      this._navigate(url);\r\n    }\r\n  },\r\n\r\n  _stateHandler () {\r\n    if (!this.$node.hasAttribute('dmx-class:active')) return;\r\n\r\n    const node = this.$node;\r\n    const url = node.getAttribute('href');\r\n    if (url && url.startsWith('#')) return;\r\n    const active = node.href == window.location.href || node.href == window.location.href.split(\"?\")[0].split(\"#\")[0];\r\n\r\n    node.classList.toggle('active', active);\r\n\r\n    if (node.classList.contains('dropdown-item')) {\r\n      const items = node.parentNode.querySelectorAll('.dropdown-item');\r\n      node.classList.remove('active');\r\n\r\n      for (let i = 0; i < items.length; i++) {\r\n        const match = items[i].href == window.location.href || items[i].href == window.location.href.split(\"?\")[0].split(\"#\")[0];\r\n        if (match) {\r\n          items[i].classList.add('active');\r\n          node.classList.add('active');\r\n        } else {\r\n          items[i].classList.remove('active');\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n});\r\n"],"sourceRoot":"../../dmxRouting"}